import{_ as O}from"./index-ed788ec2.js";import{e as R,a6 as A,r as D,l as t,aC as G,av as v,ak as s,aw as W,M as x,ax as H,E as B,o as J,h as d,ay as K,i as _,j as g,w as r,a7 as i,a8 as w,u as n,af as Q,a3 as X,ad as Y,a5 as Z,aa as ee,ab as te,az as oe,a4 as ae,at as q}from"./vue-cc42d2bc.js";import{B as re}from"./index-6584376d.js";import{B as ne,_ as le}from"./index-3da832da.js";import{d as se,e as de}from"./message-a13469e4.js";import{b as S}from"./route-block-83d24a4e.js";import"./index.esm-3690e61a.js";import"./tgs-player-8b1bea8a.js";import"./axios-4fe91515.js";const ie=u=>(ee("data-v-da129860"),u=u(),te(),u),pe={class:"flex-1 el-card border-none flex-col box-border overflow-hidden"},ce={class:"h-50px pl-12px pr-12px box-border flex items-center justify-between bd-title"},_e={class:"bd-title-left"},ue={class:"m-0 font-600"},me={class:"flex items-center h-50px"},fe={class:"flex-1 overflow-hidden p-12px"},ge={class:"bd-card-footer pl-12px pr-12px mb-12px flex items-center justify-between"},we=ie(()=>i("div",null,null,-1)),E=R({__name:"recordpersonal",setup(u){const m=A(),I=D([{prop:"message_id",label:"消息编号",fixed:"left",width:200},{prop:"sender_name",label:"发送者名字",width:140},{prop:"sender",label:"发送者ID",width:140},{prop:"avatar",label:"发送者头像",align:"center",width:100,render:e=>{let a="";return e.row.sender&&(a=`${ne.APP_URL}users/${e.row.sender}/avatar`),t(G,{src:a,size:54},{default:()=>[e.row.sender_name]})}},{prop:"payload",label:"消息内容",minWidth:300,render:e=>{if(e.row.payload){const a=e.row.payload;return e.row.is_encrypt==1?"[加密消息，无法查看]":t(re,{msg:a},null)}}},{prop:"device_id",label:"设备ID",width:160},{prop:"device_name",label:"设备名称",width:200},{prop:"device_model",label:"设备类型",width:120},{prop:"revoke",label:"是否撤回",width:120,formatter(e){return e.revoke===1?"是":"否"}},{prop:"is_deleted",label:"是否删除",width:120,formatter(e){return e.is_deleted===1?"是":"否"}},{prop:"created_at",label:"发送时间",width:170},{prop:"operation",label:"操作",align:"center",fixed:"right",width:100,render:e=>t(W,null,{default:()=>[e.row.is_deleted==0?t(v,{type:"danger",onClick:()=>$(e.row)},{default:()=>[s("删除")]}):""]})}]),k=x([]),h=x(!1),C=x(0),l=D({keyword:"",uid:m.query.uid,touid:m.query.touid,page_size:15,page_index:1}),p=()=>{h.value=!0,se(l).then(e=>{h.value=!1,k.value=e!=null&&e.list?e==null?void 0:e.list:[],C.value=e!=null&&e.count?e==null?void 0:e.count:0})},U=e=>{l.page_size=e,p()},M=e=>{l.page_index=e,p()},V=e=>{const a=[];a.push({message_id:e.message_id,message_seq:e.message_seq});const f={channel_id:m.query.uid,channel_type:1,from_uid:m.query.touid,list:a};de(f).then(y=>{y.status==200&&(p(),B({type:"success",message:"删除成功！"}))})},$=e=>{H.confirm("确定，是否删除此消息?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,type:"warning"}).then(()=>{V(e)}).catch(()=>{B({type:"info",message:"取消成功！"})})};return J(()=>{p()}),(e,a)=>{const f=d("el-text"),y=d("el-input"),b=d("el-form-item"),j=d("el-form"),N=d("i-bd-setting"),z=d("el-table-column"),P=d("el-table"),T=d("el-pagination"),F=O,L=K("loading");return _(),g(F,{class:"flex-col"},{default:r(()=>[i("div",pe,[i("div",ce,[i("div",_e,[i("p",ue,[t(f,{type:"primary"},{default:r(()=>[s(w(e.$route.query.name),1)]),_:1}),s(" 和 "),t(f,{type:"primary"},{default:r(()=>[s(w(e.$route.query.toname),1)]),_:1}),s(" 聊天记录 ")])]),i("div",me,[t(j,{inline:""},{default:r(()=>[t(b,{class:"mb-0 !mr-16px"},{default:r(()=>[t(y,{modelValue:n(l).keyword,"onUpdate:modelValue":a[0]||(a[0]=o=>n(l).keyword=o),placeholder:"发送者名字/消息内容",clearable:""},null,8,["modelValue"])]),_:1}),t(b,{class:"mb-0 !mr-16px"},{default:r(()=>[t(n(v),{type:"primary",onClick:p},{default:r(()=>[s("查询")]),_:1})]),_:1}),t(b,{class:"mb-0 !mr-0"},{default:r(()=>[t(n(v),{type:"primary",onClick:e.onDevices},{default:r(()=>[s("查看设备")]),_:1},8,["onClick"])]),_:1})]),_:1})])]),i("div",fe,[Q((_(),g(P,{data:n(k),border:!0,style:{width:"100%",height:"100%"}},{default:r(()=>[t(z,{type:"index",width:42,align:"center",fixed:"left"},{header:r(()=>[t(N,{class:"cursor-pointer",size:"16"})]),_:1}),(_(!0),X(Z,null,Y(n(I),o=>(_(),g(z,oe(o,{key:o.prop}),{default:r(c=>[o.render?(_(),g(ae(o.render),{key:0,row:c.row},null,8,["row"])):o.formatter?q(e.$slots,o.prop,{key:1,row:c.row},()=>[s(w(o.formatter(c.row)),1)],!0):q(e.$slots,o.prop,{key:2,row:c.row},()=>[s(w(c.row[o.prop]),1)],!0)]),_:2},1040))),128))]),_:3},8,["data"])),[[L,n(h)]])]),i("div",ge,[we,t(T,{"current-page":n(l).page_index,"onUpdate:currentPage":a[1]||(a[1]=o=>n(l).page_index=o),"page-size":n(l).page_size,"onUpdate:pageSize":a[2]||(a[2]=o=>n(l).page_size=o),"page-sizes":[15,20,30,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:n(C),onSizeChange:U,onCurrentChange:M},null,8,["current-page","page-size","total"])])])]),_:3})}}});typeof S=="function"&&S(E);const Be=le(E,[["__scopeId","data-v-da129860"]]);export{Be as default};
