import{_ as G}from"./index-ed788ec2.js";import{b as q,c as J}from"./message-a13469e4.js";import{e as D,M as b,U as H,h as d,i as g,j as w,w as l,l as o,ak as x,a7 as r,E as S,r as P,aC as U,o as K,ay as Q,u as i,av as W,af as X,a3 as Y,ad as Z,a5 as ee,J as te,aa as ae,ab as oe,az as le,a4 as ne,at as I,a8 as V}from"./vue-cc42d2bc.js";import{B as $,_ as re}from"./index-3da832da.js";import{b as A}from"./route-block-83d24a4e.js";import"./axios-4fe91515.js";const se=r("div",{class:"mb-20px"},[r("div",null,"给所有用户发送一条信息")],-1),ie=D({name:"BdSandAllMsg"}),de=D({...ie,props:{value:{type:Boolean,default:!1}},emits:["update:value","ok"],setup(p,{emit:y}){const m=p,_=b(""),c=b(!1);H(()=>m.value,(u,s)=>{console.log(m.value),m.value=u});const n=()=>{y("update:value",!1)},f=()=>{if(!_.value)return S.info("请输入发送内容！");const u={content:_.value};c.value=!0,q(u).then(s=>{c.value=!1,s.status==200&&(S.success("发送成功！"),_.value="",n(),y("ok",!0))}).catch(s=>{c.value=!1,s.status==400&&S.error(s.msg)})};return(u,s)=>{const v=d("el-input"),k=d("el-button"),z=d("el-space"),e=d("el-dialog");return g(),w(e,{"model-value":u.value,width:600,"align-center":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,draggable:!0,"z-index":99,title:"发送信息",onClose:n},{footer:l(()=>[o(z,null,{default:l(()=>[o(k,{onClick:n},{default:l(()=>[x("取消")]),_:1}),o(k,{type:"primary",loading:c.value,onClick:f},{default:l(()=>[x("发送")]),_:1},8,["loading"])]),_:1})]),default:l(()=>[se,r("div",null,[o(v,{modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=t=>_.value=t),rows:6,type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])])]),_:1},8,["model-value"])}}}),L=p=>(ae("data-v-0cb0478a"),p=p(),oe(),p),_e={class:"flex-1 el-card border-none flex-col box-border overflow-hidden"},ce={class:"h-50px pl-12px pr-12px box-border flex items-center justify-between bd-title"},ue=L(()=>r("div",{class:"bd-title-left"},[r("p",{class:"m-0 font-600"},"消息记录")],-1)),pe={class:"flex items-center h-50px"},me={class:"flex-1 overflow-hidden p-12px"},fe={class:"bd-card-footer pl-12px pr-12px mb-12px flex items-center justify-between"},ve=L(()=>r("div",null,null,-1)),E=D({__name:"sendmsglist",setup(p){const y=P([{prop:"sender_name",label:"发送者名字",fixed:"left",width:140},{prop:"sender",label:"发送者ID",width:120},{prop:"sender_avatar",label:"发送者头像",align:"center",width:100,render:e=>{let t="";return e.row.sender&&(t=`${$.APP_URL}users/${e.row.sender}/avatar`),o(U,{src:t,size:54},{default:()=>[e.row.sender_name]})}},{prop:"receiver",label:"接受者ID",width:300},{prop:"receiver_name",label:"接受者名字",width:180},{prop:"receiver_avatar",label:"接受者头像",align:"center",width:100,render:e=>{let t="";if(e.row.receiver){const C=e.row.receiver_channel_type==1?"users":"groups";t=`${$.APP_URL}${C}/${e.row.receiver}/avatar`}return o(U,{src:t,size:54},{default:()=>[e.row.receiver_name]})}},{prop:"register_time",label:"聊天类型",width:90,formatter(e){return e.receiver_channel_type===1?"单聊":"群聊"}},{prop:"handler_uid",label:"操作者ID",width:140},{prop:"handler_name",label:"操作者名字",width:120},{prop:"handler_uid",label:"操作者头像",align:"center",width:100,render:e=>{let t="";return e.row.handler_uid&&(t=`${$.APP_URL}users/${e.row.handler_uid}/avatar`),o(U,{src:t,size:54},{default:()=>[e.row.handler_name]})}},{prop:"content",label:"消息内容",width:260},{prop:"created_at",label:"消息发送时间",width:170}]),m=b([]),_=b(!1),c=b(0),n=P({page_size:15,page_index:1}),f=()=>{_.value=!0,J(n).then(e=>{_.value=!1,m.value=e.list,c.value=e.count})},u=e=>{n.page_size=e,f()},s=e=>{n.page_index=e,f()},v=b(!1),k=()=>{v.value=!0},z=()=>{f()};return K(()=>{f()}),(e,t)=>{const C=d("el-form-item"),R=d("el-form"),j=d("i-bd-setting"),B=d("el-table-column"),M=d("el-table"),N=d("el-pagination"),F=de,O=G,T=Q("loading");return g(),w(O,{class:"flex-col"},{default:l(()=>[r("div",_e,[r("div",ce,[ue,r("div",pe,[o(R,{inline:""},{default:l(()=>[o(C,{class:"mb-0 !mr-0"},{default:l(()=>[o(i(W),{type:"primary",onClick:k},{default:l(()=>[x("发送消息")]),_:1})]),_:1})]),_:1})])]),r("div",me,[X((g(),w(M,{data:i(m),border:!0,style:{width:"100%",height:"100%"}},{default:l(()=>[o(B,{type:"index",width:42,align:"center",fixed:"left"},{header:l(()=>[o(j,{class:"cursor-pointer",size:"16"})]),_:1}),(g(!0),Y(ee,null,Z(i(y),a=>(g(),w(B,le(a,{key:a.prop}),{default:l(h=>[a.render?(g(),w(ne(a.render),{key:0,row:h.row},null,8,["row"])):a.formatter?I(e.$slots,a.prop,{key:1,row:h.row},()=>[x(V(a.formatter(h.row)),1)],!0):I(e.$slots,a.prop,{key:2,row:h.row},()=>[x(V(h.row[a.prop]),1)],!0)]),_:2},1040))),128))]),_:3},8,["data"])),[[T,i(_)]])]),r("div",fe,[ve,o(N,{"current-page":i(n).page_index,"onUpdate:currentPage":t[0]||(t[0]=a=>i(n).page_index=a),"page-size":i(n).page_size,"onUpdate:pageSize":t[1]||(t[1]=a=>i(n).page_size=a),"page-sizes":[15,20,30,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:i(c),onSizeChange:u,onCurrentChange:s},null,8,["current-page","page-size","total"])])]),o(F,{value:i(v),"onUpdate:value":t[2]||(t[2]=a=>te(v)?v.value=a:null),onOk:z},null,8,["value"])]),_:3})}}});typeof A=="function"&&A(E);const ke=re(E,[["__scopeId","data-v-0cb0478a"]]);export{ke as default};
