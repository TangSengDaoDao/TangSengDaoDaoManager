import{_ as G}from"./index-ed788ec2.js";import{e as J,a6 as W,r as S,l as a,aC as H,av as h,ak as d,aw as K,M as _,ax as Q,E as y,o as X,h as l,ay as Y,i as u,j as g,w as s,a7 as i,a8 as x,u as r,af as Z,a3 as ee,ad as te,a5 as oe,J as ae,aa as re,ab as ne,az as se,a4 as le,at as U}from"./vue-cc42d2bc.js";import{B as ie}from"./index-6584376d.js";import{_ as de}from"./Devices.vue_vue_type_script_name_Devices_setup_true_lang-16e522dc.js";import{B as pe,_ as ce}from"./index-3da832da.js";import{f as _e,e as ue}from"./message-a13469e4.js";import{b as I}from"./route-block-83d24a4e.js";import"./index.esm-3690e61a.js";import"./tgs-player-8b1bea8a.js";import"./axios-4fe91515.js";const me=m=>(re("data-v-2523b915"),m=m(),ne(),m),fe={class:"flex-1 el-card border-none flex-col box-border overflow-hidden"},ge={class:"h-50px pl-12px pr-12px box-border flex items-center justify-between bd-title"},we={class:"bd-title-left"},be={class:"m-0 font-600"},ve={class:"flex items-center h-50px"},he={class:"flex-1 overflow-hidden p-12px"},ye={class:"bd-card-footer pl-12px pr-12px mb-12px flex items-center justify-between"},xe=me(()=>i("div",null,null,-1)),V=J({__name:"record",setup(m){const k=W(),q=S([{prop:"message_id",label:"消息编号",fixed:"left",width:200},{prop:"sender_name",label:"发送者名字",width:140},{prop:"sender",label:"发送者ID",width:260},{prop:"avatar",label:"发送者头像",align:"center",width:100,render:e=>{let o="";return e.row.sender&&(o=`${pe.APP_URL}users/${e.row.sender}/avatar`),a(H,{src:o,size:54},{default:()=>[e.row.sender_name]})}},{prop:"payload",label:"消息内容",minWidth:300,render:e=>{if(e.row.payload){const o=e.row.payload;return e.row.is_encrypt==1?"[加密消息，无法查看]":a(ie,{msg:o},null)}}},{prop:"device_id",label:"设备ID",width:160},{prop:"device_name",label:"设备名称",width:200},{prop:"device_model",label:"设备类型",width:120},{prop:"revoke",label:"是否撤回",width:120,formatter(e){return e.revoke===1?"是":"否"}},{prop:"is_deleted",label:"是否删除",width:120,formatter(e){return e.is_deleted===1?"是":"否"}},{prop:"created_at",label:"发送时间",width:180},{prop:"operation",label:"操作",align:"center",fixed:"right",width:190,render:e=>a(K,null,{default:()=>[a(h,{type:"primary",onClick:()=>P(e.row)},{default:()=>[d("查看设备")]}),e.row.is_deleted==0?a(h,{type:"danger",onClick:()=>j(e.row)},{default:()=>[d("删除")]}):""]})}]),C=_([]),w=_(!1),B=_(0),n=S({keyword:"",channel_id:k.query.groupNo,page_size:15,page_index:1}),p=()=>{w.value=!0,_e(n).then(e=>{w.value=!1,C.value=e.list,B.value=e.count})},M=e=>{n.page_size=e,p()},N=e=>{n.page_index=e,p()},$=e=>{const o=[];o.push({message_id:e.message_id,message_seq:e.message_seq});const b={channel_id:k.query.groupNo,channel_type:2,list:o};ue(b).then(v=>{v.status==200&&(p(),y({type:"success",message:"删除成功！"}))})},j=e=>{Q.confirm("确定，是否删除此消息?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,type:"warning"}).then(()=>{$(e)}).catch(()=>{y({type:"info",message:"取消成功！"})})},f=_(!1),z=_(""),P=e=>{e.sender?(z.value=e.sender,f.value=!0):y({type:"warning",message:"无用户，不能查看设备！"})};return X(()=>{p()}),(e,o)=>{const b=l("el-text"),v=l("el-input"),D=l("el-form-item"),R=l("el-form"),T=l("i-bd-setting"),E=l("el-table-column"),F=l("el-table"),L=l("el-pagination"),O=G,A=Y("loading");return u(),g(O,{class:"flex-col"},{default:s(()=>[i("div",fe,[i("div",ge,[i("div",we,[i("p",be,[a(b,{type:"primary"},{default:s(()=>[d(x(e.$route.query.name),1)]),_:1}),d(" 的聊天记录 ")])]),i("div",ve,[a(R,{inline:""},{default:s(()=>[a(D,{class:"mb-0 !mr-16px"},{default:s(()=>[a(v,{modelValue:r(n).keyword,"onUpdate:modelValue":o[0]||(o[0]=t=>r(n).keyword=t),placeholder:"发送者名字/消息内容",clearable:""},null,8,["modelValue"])]),_:1}),a(D,{class:"mb-0 !mr-0"},{default:s(()=>[a(r(h),{type:"primary",onClick:p},{default:s(()=>[d("查询")]),_:1})]),_:1})]),_:1})])]),i("div",he,[Z((u(),g(F,{data:r(C),border:!0,style:{width:"100%",height:"100%"}},{default:s(()=>[a(E,{type:"index",width:42,align:"center",fixed:"left"},{header:s(()=>[a(T,{class:"cursor-pointer",size:"16"})]),_:1}),(u(!0),ee(oe,null,te(r(q),t=>(u(),g(E,se(t,{key:t.prop}),{default:s(c=>[t.render?(u(),g(le(t.render),{key:0,row:c.row},null,8,["row"])):t.formatter?U(e.$slots,t.prop,{key:1,row:c.row},()=>[d(x(t.formatter(c.row)),1)],!0):U(e.$slots,t.prop,{key:2,row:c.row},()=>[d(x(c.row[t.prop]),1)],!0)]),_:2},1040))),128))]),_:3},8,["data"])),[[A,r(w)]])]),i("div",ye,[xe,a(L,{"current-page":r(n).page_index,"onUpdate:currentPage":o[1]||(o[1]=t=>r(n).page_index=t),"page-size":r(n).page_size,"onUpdate:pageSize":o[2]||(o[2]=t=>r(n).page_size=t),"page-sizes":[15,20,30,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:r(B),onSizeChange:M,onCurrentChange:N},null,8,["current-page","page-size","total"])])]),a(de,{value:r(f),"onUpdate:value":o[3]||(o[3]=t=>ae(f)?f.value=t:null),uid:r(z)},null,8,["value","uid"])]),_:3})}}});typeof I=="function"&&I(V);const qe=ce(V,[["__scopeId","data-v-2523b915"]]);export{qe as default};
