import{_ as T}from"./index-ed788ec2.js";import{b as G,_ as q}from"./index-3da832da.js";import{a as M}from"./axios-4fe91515.js";import{f as H}from"./file-5a001aff.js";import{e as L,U as J,M as g,r as R,h as d,i as v,j as k,w as o,l as e,ak as u,u as t,a7 as f,E as P,o as W,ay as K,av as Q,af as X,a3 as Y,ad as Z,a5 as ee,J as oe,aa as ae,ab as te,az as le,a4 as ne,at as j,a8 as E,ah as se}from"./vue-cc42d2bc.js";import{b as F}from"./route-block-83d24a4e.js";function re(c){return M({url:"/common/appversion/list",method:"get",params:c})}function de(c){return M({url:"/common/appversion",method:"post",data:c})}const pe={class:"w-100%"},ue=L({name:"BdAppVersion"}),ie=L({...ue,props:{value:{type:Boolean,default:!1}},emits:["update:value","ok"],setup(c,{emit:z}){const x=c;J(()=>x.value,(a,s)=>{x.value=a});const w=G(),C=g(""),i=g(!1),l=R({app_version:"",os:"android",is_force:0,update_desc:"",download_url:"",signature:""}),A={token:w.token},S=g(""),b=async a=>{const s={path:`/${a.uid}/${a.name}`,type:"common"},_=await H(s);return _.url?(S.value=`${_.url}&signature=1`,!0):!1},B=(a,s)=>{console.log(a),l.download_url=a.path,l.signature=a.sha512},h=()=>{z("update:value",!1)},p=()=>{i.value=!0,de(l).then(a=>{i.value=!1,a.status==200&&(P.success("新增成功！"),C.value="",h(),z("ok",!0))}).catch(a=>{i.value=!1,a.status==400&&P.error(a.msg)})};return(a,s)=>{const _=d("el-radio"),U=d("el-radio-group"),m=d("el-form-item"),y=d("el-button"),D=d("el-upload"),V=d("el-input"),$=d("el-form"),I=d("el-space"),n=d("el-dialog");return v(),k(n,{"model-value":a.value,width:600,"align-center":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,draggable:!0,"z-index":99,title:"新增版本",onClose:h},{footer:o(()=>[e(I,null,{default:o(()=>[e(y,{onClick:h},{default:o(()=>[u("取消")]),_:1}),e(y,{type:"primary",loading:i.value,onClick:p},{default:o(()=>[u("发送")]),_:1},8,["loading"])]),_:1})]),default:o(()=>[e($,{model:t(l),"label-width":"120px"},{default:o(()=>[e(m,{label:"升级平台"},{default:o(()=>[e(U,{modelValue:t(l).os,"onUpdate:modelValue":s[0]||(s[0]=r=>t(l).os=r)},{default:o(()=>[e(_,{label:"android"},{default:o(()=>[u(" Android")]),_:1}),e(_,{label:"ios"},{default:o(()=>[u("IOS")]),_:1}),e(_,{label:"mac"},{default:o(()=>[u("Mac")]),_:1}),e(_,{label:"windows"},{default:o(()=>[u("Windows")]),_:1}),e(_,{label:"linx"},{default:o(()=>[u("Linux")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"升级操作"},{default:o(()=>[e(U,{modelValue:t(l).is_force,"onUpdate:modelValue":s[1]||(s[1]=r=>t(l).is_force=r)},{default:o(()=>[e(_,{label:1},{default:o(()=>[u("强制更新")]),_:1}),e(_,{label:0},{default:o(()=>[u("非强制更新")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"安装包"},{default:o(()=>[f("div",pe,[e(D,{ref:"upload",action:S.value,limit:1,headers:A,"before-upload":b,"on-success":B},{trigger:o(()=>[e(y,{type:"primary"},{default:o(()=>[u("点击上传安装包")]),_:1})]),_:1},8,["action"])])]),_:1}),e(m,{label:"SHA512"},{default:o(()=>[e(V,{modelValue:t(l).signature,"onUpdate:modelValue":s[2]||(s[2]=r=>t(l).signature=r),type:"textarea",placeholder:"请输入sha512",autosize:{minRows:4,maxRows:6}},null,8,["modelValue"])]),_:1}),e(m,{label:"版本号"},{default:o(()=>[e(V,{modelValue:t(l).app_version,"onUpdate:modelValue":s[3]||(s[3]=r=>t(l).app_version=r),placeholder:"请输入版本号"},null,8,["modelValue"])]),_:1}),e(m,{label:"升级说明"},{default:o(()=>[e(V,{modelValue:t(l).update_desc,"onUpdate:modelValue":s[4]||(s[4]=r=>t(l).update_desc=r),type:"textarea",autosize:{minRows:6,maxRows:8},placeholder:"请输入升级说明如：1、新增朋友圈功能 2、修复已知问题"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}}),N=c=>(ae("data-v-caaa575b"),c=c(),te(),c),_e={class:"flex-1 el-card border-none flex-col box-border overflow-hidden"},ce={class:"h-50px pl-12px pr-12px box-border flex items-center justify-between bd-title"},me=N(()=>f("div",{class:"bd-title-left"},[f("p",{class:"m-0 font-600"},"APP升级")],-1)),fe={class:"flex items-center h-50px"},ge={class:"flex-1 overflow-hidden p-12px"},be={class:"bd-card-footer pl-12px pr-12px mb-12px flex items-center justify-between"},ve=N(()=>f("div",null,null,-1)),O=L({__name:"appupdate",setup(c){const z=R([{prop:"os",label:"升级平台",width:140},{prop:"app_version",label:"升级版本号",width:120},{prop:"is_force",label:"是否强制更新",width:220,formatter(p){return p.is_force===1?"是":"否"}},{prop:"update_desc",label:"升级说明"},{prop:"created_at",label:"发布时间",width:170}]),x=g([]),w=g(!1),C=g(0),i=R({page_size:15,page_index:1}),l=()=>{w.value=!0,re(i).then(p=>{w.value=!1,x.value=p.list,C.value=p.count})},A=p=>{i.page_size=p,l()},S=p=>{i.page_index=p,l()},b=g(!1),B=()=>{b.value=!0},h=()=>{l()};return W(()=>{l()}),(p,a)=>{const s=d("el-form-item"),_=d("el-form"),U=d("i-bd-setting"),m=d("el-table-column"),y=d("el-table"),D=d("el-pagination"),V=ie,$=T,I=K("loading");return v(),k($,{class:"flex-col"},{default:o(()=>[f("div",_e,[f("div",ce,[me,f("div",fe,[e(_,{inline:""},{default:o(()=>[e(s,{class:"mb-0 !mr-0"},{default:o(()=>[e(t(Q),{type:"primary",onClick:B},{default:o(()=>[u("新增版本")]),_:1})]),_:1})]),_:1})])]),f("div",ge,[X((v(),k(y,{data:t(x),border:!0,style:{width:"100%",height:"100%"}},{default:o(()=>[e(m,{type:"index",width:42,align:"center",fixed:"left"},{header:o(()=>[e(U,{class:"cursor-pointer",size:"16"})]),_:1}),(v(!0),Y(ee,null,Z(t(z),n=>(v(),k(m,le(n,{key:n.prop}),{default:o(r=>[n.render?(v(),k(ne(n.render),{key:0,row:r.row},null,8,["row"])):n.formatter?j(p.$slots,n.prop,{key:1,row:r.row},()=>[u(E(n.formatter(r.row)),1)],!0):n.prop?j(p.$slots,n.prop,{key:2,row:r.row},()=>[u(E(r.row[n.prop]),1)],!0):se("",!0)]),_:2},1040))),128))]),_:3},8,["data"])),[[I,t(w)]])]),f("div",be,[ve,e(D,{"current-page":t(i).page_index,"onUpdate:currentPage":a[0]||(a[0]=n=>t(i).page_index=n),"page-size":t(i).page_size,"onUpdate:pageSize":a[1]||(a[1]=n=>t(i).page_size=n),"page-sizes":[15,20,30,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:t(C),onSizeChange:A,onCurrentChange:S},null,8,["current-page","page-size","total"])])]),e(V,{value:t(b),"onUpdate:value":a[2]||(a[2]=n=>oe(b)?b.value=n:null),onOk:h},null,8,["value"])]),_:3})}}});typeof F=="function"&&F(O);const ze=q(O,[["__scopeId","data-v-caaa575b"]]);export{ze as default};
