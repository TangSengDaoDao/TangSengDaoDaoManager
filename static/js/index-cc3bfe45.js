import{_ as Q}from"./index-ed788ec2.js";import{_ as Z}from"./index.esm-3690e61a.js";import{e as R,M as m,U as ee,h as u,i as w,j as C,w as t,l as e,ak as c,a3 as q,u as r,au as ae,E as x,r as M,av as j,aw as te,ax as le,o as oe,ay as ne,a7 as h,af as se,ad as pe,a5 as re,J as ue,aa as de,ab as ie,az as ce,a4 as _e,at as N,a8 as G,ah as me}from"./vue-cc42d2bc.js";import{b as fe,B as J,_ as X}from"./index-3da832da.js";import{a as ve,b as ge,c as be,d as ye}from"./app-55673b08.js";import{f as we}from"./file-5a001aff.js";import{b as W}from"./route-block-83d24a4e.js";import"./axios-4fe91515.js";const he=["src"],xe=R({name:"Apply"}),ke=R({...xe,props:{value:{type:Boolean,default:!1},title:{default:"新增应用"},type:{default:"add"},data:{}},emits:["update:value","ok"],setup(k,{emit:f}){const _=k,U=fe(),D=m(""),v=m(!1),o=m({icon:"",name:"",jump_type:0,description:"",app_route:"",web_route:"",is_paid_app:0});ee(()=>_.value,(s,l)=>{_.value=s,s&&_.type=="edit"&&(o.value=_.data),s||(o.value={icon:"",name:"",jump_type:0,description:"",app_route:"",web_route:"",is_paid_app:0})});const I={token:U.token},z=m(""),V=async s=>{const l={path:`/${s.uid}/${s.name}`,type:"report"},g=await we(l);return g.url?(z.value=g.url,!0):!1},S=(s,l)=>{o.value.icon=s.path},d=()=>{f("update:value",!1)},b=()=>{v.value=!0,ve(o.value).then(s=>{v.value=!1,s.status==200&&(x.success("新增成功！"),D.value="",d(),f("ok",!0))}).catch(s=>{v.value=!1,s.status==400&&x.error(s.msg)})},B=()=>{v.value=!0;const s=_.data.app_id;ge(o.value,s).then(l=>{v.value=!1,l.status==200&&(x.success("编辑成功！"),D.value="",d(),f("ok",!0))}).catch(l=>{v.value=!1,l.status==400&&x.error(l.msg)})},T=()=>{_.type==="add"&&b(),_.type==="edit"&&B()};return(s,l)=>{const g=u("el-input"),a=u("el-form-item"),n=u("el-icon"),E=u("el-upload"),y=u("el-radio"),$=u("el-radio-group"),F=u("el-form"),A=u("el-button"),L=u("el-space"),O=u("el-dialog");return w(),C(O,{"model-value":s.value,width:600,"align-center":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,draggable:!0,"z-index":99,title:s.title,onClose:d},{footer:t(()=>[e(L,null,{default:t(()=>[e(A,{onClick:d},{default:t(()=>[c("取消")]),_:1}),e(A,{type:"primary",loading:v.value,onClick:T},{default:t(()=>[c("保存")]),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(F,{model:o.value,"label-width":"96px"},{default:t(()=>[e(a,{label:"应用名称"},{default:t(()=>[e(g,{modelValue:o.value.name,"onUpdate:modelValue":l[0]||(l[0]=i=>o.value.name=i),placeholder:"请输入应用名称",maxlength:"10","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(a,{label:"应用图标"},{default:t(()=>[e(E,{ref:"upload",class:"bd-upload",action:z.value,"list-type":"picture-card","show-file-list":!1,headers:I,"before-upload":V,"on-success":S},{default:t(()=>[o.value.icon?(w(),q("img",{key:0,src:`${r(J).APP_URL}${o.value.icon}`,class:"avatar"},null,8,he)):(w(),C(n,{key:1},{default:t(()=>[e(r(ae))]),_:1}))]),_:1},8,["action"])]),_:1}),e(a,{label:"打开方式"},{default:t(()=>[e($,{modelValue:o.value.jump_type,"onUpdate:modelValue":l[1]||(l[1]=i=>o.value.jump_type=i)},{default:t(()=>[e(y,{label:0},{default:t(()=>[c("网页")]),_:1}),e(y,{label:1},{default:t(()=>[c("APP")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(a,{label:"网页地址"},{default:t(()=>[e(g,{modelValue:o.value.web_route,"onUpdate:modelValue":l[2]||(l[2]=i=>o.value.web_route=i),placeholder:"请输入网页地址"},null,8,["modelValue"])]),_:1}),e(a,{label:"APP地址"},{default:t(()=>[e(g,{modelValue:o.value.app_route,"onUpdate:modelValue":l[3]||(l[3]=i=>o.value.app_route=i),placeholder:"请输入APP地址"},null,8,["modelValue"])]),_:1}),e(a,{label:"付款"},{default:t(()=>[e($,{modelValue:o.value.is_paid_app,"onUpdate:modelValue":l[4]||(l[4]=i=>o.value.is_paid_app=i)},{default:t(()=>[e(y,{label:0},{default:t(()=>[c("免费")]),_:1}),e(y,{label:1},{default:t(()=>[c("付费")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(a,{label:"应用描述"},{default:t(()=>[e(g,{modelValue:o.value.description,"onUpdate:modelValue":l[5]||(l[5]=i=>o.value.description=i),type:"textarea",autosize:{minRows:6,maxRows:8},placeholder:"请输入应用描述","show-word-limit":"",maxlength:"500"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","title"])}}});const Ve=X(ke,[["__scopeId","data-v-06d58253"]]),Y=k=>(de("data-v-4b8c0ad3"),k=k(),ie(),k),Ce={class:"flex-1 el-card border-none flex-col box-border overflow-hidden"},Ue={class:"h-50px pl-12px pr-12px box-border flex items-center justify-between bd-title"},ze=Y(()=>h("div",{class:"bd-title-left"},[h("p",{class:"m-0 font-600"},"应用管理")],-1)),Ae={class:"flex items-center h-50px"},Pe={class:"flex-1 overflow-hidden p-12px"},De={class:"bd-card-footer pl-12px pr-12px mb-12px flex items-center justify-between"},Se=Y(()=>h("div",null,null,-1)),H=R({__name:"index",setup(k){const f=m(!1),_=m("新增应用"),U=m("add"),D=()=>{f.value=!0,_.value="新增应用",U.value="add"},v=()=>{b()},o=a=>{const n=[];n.push({src:a}),Z.show(n,{Toolbar:{display:{left:["infobar"],middle:["zoomIn","zoomOut","toggle1to1","rotateCCW","rotateCW","flipX","flipY"],right:["slideshow","thumbs","close"]}}})},I=M([{prop:"icon",label:"应用LOGO",align:"center",width:100,render:a=>{let n="";return a.row.icon&&(n=`${J.APP_URL}${a.row.icon}`),e("img",{src:n,class:"w-60px h-60px cursor-pointer",onClick:()=>o(n)},null)}},{prop:"name",label:"应用名称",width:160},{prop:"app_id",label:"应用APP ID",width:290},{prop:"status",label:"应用状态",width:100,formatter(a){return a.status===1?"开启":"关闭"}},{prop:"description",label:"应用描述"},{prop:"operation",label:"操作",width:150,align:"center",render:a=>e(te,null,{default:()=>[e(j,{type:"primary",onClick:()=>T(a.row)},{default:()=>[c("编辑")]}),e(j,{type:"danger",onClick:()=>s(a.row)},{default:()=>[c("删除")]})]})}]),z=m([]),V=m(!1),S=m(0),d=M({keyword:"",page_size:15,page_index:1}),b=()=>{V.value=!0,ye(d).then(a=>{V.value=!1,z.value=a.list||[],S.value=a.count||0}).catch(()=>{V.value=!1})},B=m({}),T=a=>{_.value=`编辑${a.name}`,B.value=a,U.value="edit",f.value=!0},s=a=>{le.confirm("确定要对该应用删除吗?","操作提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,type:"warning"}).then(()=>{be(a.app_id).then(n=>{b(),x({type:"success",message:"应用删除成功！"})}).catch(n=>{n.status==400&&x.error(n.msg)})}).catch(()=>{x({type:"info",message:"取消成功！"})})},l=a=>{d.page_size=a,b()},g=a=>{d.page_index=a,b()};return oe(()=>{b()}),(a,n)=>{const E=u("el-input"),y=u("el-form-item"),$=u("el-form"),F=u("i-bd-setting"),A=u("el-table-column"),L=u("el-table"),O=u("el-pagination"),i=Q,K=ne("loading");return w(),C(i,{class:"flex-col"},{default:t(()=>[h("div",Ce,[h("div",Ue,[ze,h("div",Ae,[e($,{inline:""},{default:t(()=>[e(y,{class:"mb-0 !mr-16px"},{default:t(()=>[e(E,{modelValue:r(d).keyword,"onUpdate:modelValue":n[0]||(n[0]=p=>r(d).keyword=p),placeholder:"应用名称",clearable:""},null,8,["modelValue"])]),_:1}),e(y,{class:"mb-0 !mr-16px"},{default:t(()=>[e(r(j),{type:"primary",onClick:b},{default:t(()=>[c("查询")]),_:1})]),_:1}),e(y,{class:"mb-0 !mr-0"},{default:t(()=>[e(r(j),{type:"primary",onClick:D},{default:t(()=>[c("新增应用")]),_:1})]),_:1})]),_:1})])]),h("div",Pe,[se((w(),C(L,{data:r(z),border:!0,style:{width:"100%",height:"100%"}},{default:t(()=>[e(A,{type:"index",width:42,align:"center",fixed:"left"},{header:t(()=>[e(F,{class:"cursor-pointer",size:"16"})]),_:1}),(w(!0),q(re,null,pe(r(I),p=>(w(),C(A,ce(p,{key:p.prop}),{default:t(P=>[p.render?(w(),C(_e(p.render),{key:0,row:P.row},null,8,["row"])):p.formatter?N(a.$slots,p.prop,{key:1,row:P.row},()=>[c(G(p.formatter(P.row)),1)],!0):p.prop?N(a.$slots,p.prop,{key:2,row:P.row},()=>[c(G(P.row[p.prop]),1)],!0):me("",!0)]),_:2},1040))),128))]),_:3},8,["data"])),[[K,r(V)]])]),h("div",De,[Se,e(O,{"current-page":r(d).page_index,"onUpdate:currentPage":n[1]||(n[1]=p=>r(d).page_index=p),"page-size":r(d).page_size,"onUpdate:pageSize":n[2]||(n[2]=p=>r(d).page_size=p),"page-sizes":[15,20,30,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:r(S),onSizeChange:l,onCurrentChange:g},null,8,["current-page","page-size","total"])])]),e(Ve,{value:r(f),"onUpdate:value":n[3]||(n[3]=p=>ue(f)?f.value=p:null),type:r(U),title:r(_),data:r(B),onOk:v},null,8,["value","type","title","data"])]),_:3})}}});typeof W=="function"&&W(H);const Oe=X(H,[["__scopeId","data-v-4b8c0ad3"]]);export{Oe as default};
